<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VocalScribe - Your Voice, Your Words</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- SEO Meta Tags -->
    <meta name="description"
          content="VocalScribe - Transform your voice into written words effortlessly. Start recording your voice and get instant text responses.">
    <meta name="keywords"
          content="voice to text, speech recognition, vocal transcription, voice recording, text conversion">
    <meta name="author" content="Your Name">

    <!-- Social Media Meta Tags -->
    <meta property="og:title" content="VocalScribe - Your Voice, Your Words">
    <meta property="og:description"
          content="Transform your voice into written words effortlessly. Start recording your voice and get instant text responses.">
    <meta property="og:image" content="/static/logo.webp">
    <meta property="og:url" content="https://recording-optimizer-production.up.railway.app/">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="VocalScribe - Your Voice, Your Words">
    <meta name="twitter:description"
          content="Transform your voice into written words effortlessly. Start recording your voice and get instant text responses.">
    <meta name="twitter:image" content="/static/logo.webp">
    <style>
        body {
            background-color: #f8f9fa;
            color: #343a40;
            font-family: 'Arial', sans-serif;
        }

        #main-content {
            max-width: 800px;
            margin: 50px auto;
            background-color: #ffffff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        #brand-name {
            font-size: 2.5rem;
            font-weight: bold;
            color: #007bff;
        }

        .output {
            background-color: #e9ecef;
            padding: 10px;
            border-radius: 5px;
        }

        .unsupported-message {
            display: none;
            color: red;
        }
    </style>
</head>
<body>
<div class="container-fluid" id="main-content">
    <h1 id="brand-name">VocalScribe</h1>
    <p>Your Voice, Your Words - Record and practice your speeches or write essays using your voice.</p>
    <button id="record" type="button" class="btn btn-primary">Start Record</button>
    <button class="btn btn-danger" id="stop">Stop</button>
    <p id="unsupported-message" class="unsupported-message">Sorry, your browser does not support speech recognition. Please try using Google Chrome.</p>
    <div class="output mt-3">
        <h2>Copy your response below!</h2>
        <p id="response" class="border p-3"></p>
    </div>
    <script>
        const startButton = document.getElementById('record');
        const stopButton = document.getElementById('stop');
        const outputDiv = document.getElementById('response');
        const unsupportedMessage = document.getElementById('unsupported-message');

        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

        if (SpeechRecognition) {
            const recognition = new SpeechRecognition();
            recognition.lang = 'en-US';
            recognition.continuous = false;

            let isRecording = false;

            const startRecognition = () => {
                recognition.start();
            };

            recognition.onstart = () => {
                isRecording = true;
                startButton.textContent = 'Listening...';
                startButton.disabled = true;
                stopButton.disabled = false;
            };

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                fetch('/', {
                    method: "POST",
                    body: JSON.stringify({ recorded_text: transcript }),
                    headers: { "Content-type": "application/json; charset=UTF-8" }
                })
                .then(response => response.json())
                .then(json => {
                    console.log("is fetching");
                    const newMessage = document.createElement('p');
                    newMessage.textContent = json;
                    outputDiv.appendChild(newMessage);
                })
                .catch(error => {
                    console.error('Error:', error);
                    outputDiv.textContent = 'Error processing your request. Please try again.';
                });
            };

            recognition.onend = () => {
                if (isRecording) {
                    startRecognition();
                } else {
                    startButton.textContent = 'Start Record';
                    startButton.disabled = false;
                    stopButton.disabled = true;
                }
            };

            startButton.addEventListener('click', () => {
                if (!isRecording) {
                    isRecording = true;
                    startRecognition();
                    console.log("Is recording");
                }
            });

            stopButton.addEventListener('click', () => {
                if (isRecording) {
                    isRecording = false;
                    recognition.stop();
                }
            });

            // Initialize buttons state
            stopButton.disabled = true;
        } else {
            unsupportedMessage.style.display = 'block';
            startButton.disabled = true;
            stopButton.disabled = true;
        }
    </script>
</div>
</body>
</html>
